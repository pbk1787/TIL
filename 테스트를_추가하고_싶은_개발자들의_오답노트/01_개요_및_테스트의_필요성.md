# Java/Spring 테스트를 추가하고 싶은 개발자들의 오답노트
 > [인프런] Java/Spring 테스트를 추가하고 싶은 개발자들의 오답노트를 학습하며 작성하였습니다.
 >  - [테스트 샘플 프로젝트 1](https://github.com/pbk1787/test-sample "sample project link 1")
 >  - [테스트 샘플 프로젝트 2](https://github.com/pbk1787/test-sample2 "sample project link 1")

 ## 개요
 ### 테스트가 필요한 이유는 무엇일까?
    레거시 프로젝트에 추가적인 기능을 추가하거나 업그레이드할 때 회귀 버그가 나타날 수 있다.
    - 회귀 버그(Regression): 동작하던 기능이 추가 배포로 인해 작동하지 않는 버그
    ⇒ 회귀 버그에 효과적인 테스트를 추가하자 (겸사겸사 TDD도 적용하자)
### 내가 하는 TDD는 왜 실패하는 것인가?
    1. 테스트하기 어려운 기능    
        ex) 외부 시스템, DB 연동 기능 → Mockito, H2 해결 가능  
    2. 요령 없이 짠 옛날 테스트 코드
    3. 비결정적인 테스트 (테스트 결과가 일관적이지 않은 테스트)
    ⇒ 개발 속도를 높이기 위해 도입했지만 개발 속도만 느려지고 복잡함
### 무엇이 문제였는가?
    1. 레거시 코드에 테스트를 넣는게, TDD가 아니다.
    2. 레거시에 테스트를 넣으려면 코드 개선이 필요하다.
        - 테스트의 목적
            (1) 회귀 버그 방지
            (2) 유연한 설계로 개선 
                → 테스트를 쉽게 만들어줌.
                테스트를 결정적이게 만들어줌.
                
    3. 커버리지에 집착하면 안된다.
        ⇒ 커버리지를 올리기위한 mock 프레임워크와 사용법만 고민하고, 왜 테스트를 해야하고, 어떻게 해야하는지 고민하지 않았기 때문

### 해결책
**TDD를 논하기 전에 테스트가 가능한 구조로 변경 되어야 한다.**

----

## 테스트란?

    : 어떤 시스템이 제대로 동작하는지 검증하는 과정

    - 인수 테스트: 사람이 직접 테스트하며 체크리스트를 체크함
    - 자동 테스트: 테스트 코드(미리 짜여진 코드)를 실행하여 결과값과 예상값을 비교하는 것

### TDD

    : 테스트 주도 개발

    - RED: 실패하는 테스트를 먼저 작성한다
        - 테스트가 실패하는지 제대로 확인해야한다
    - GREEN: 실패하는 테스트를 성공시킨다
    - BLUE: 리팩토링한다
    ⇒ 계속 반복하여 개발한다

    장점
        1. 실패하는 테스트를 먼저 작성해야하기 때문에, 인터페이스를 먼저 만드는 것이 강제된다
            → What/Who 사이클을 고민하게 도와준다 (어떤 행위를 누가 수행할지 결정하는 과정)
            
        2. 장기적인 관점에서 개발 비용 감소
            → 신규 개발시 전체 테스트로 문제 확인을 바로 할 수 있음
        

    단점
        1. 초기 개발 비용
        2. 난이도
            → 구성원의 숙련도가 뒷받침되어야 함

### 개발자의 고민
    1. 무의미한 테스트
    2. 느리고 쉽게 깨지는 테스트
    3. 테스트가 불가한 코드

    ⇒ 테스트가 보내는 신호. 테스트는 좋은 설계를 유도한다

### 테스트는 왜 필요한가?

    1. 레거시 코드 
        레거시 코드란 무엇일까? => 테스트가 필요 없는 코드, 손대기 두려운 낡은 코드
    2. Regression을 없애기 위해 (회귀 버그)
    3. 좋은 아키텍처 유도
        - 좋은 아키텍처란?
            - 객체지향 SOLID 원칙을 지키는 것
                - S : 단일 책임 원칙
                    - 테스트는 명료하고 간단하게 작성해야 하기 때문에, 단일 책임 원칙을 지키게 됨
                    - 테스트가 너무 많아져서 이게 무슨 목적의 클래스인지 눈에 안들어오는 지점이 생김
                        → 이때가 클래스를 분할해야 하는 시점, 그러면서 책임이 자연스럽게 분배 됨
                        
                - O : 개방 폐쇄 원칙
                    - 테스트 컴포넌트와 프로덕션 컴포넌트를 나눠 작업하게 되고 필요에 따라 컴포넌트를 탈부착이 가능하게 개발하게 됨. 
                    서로에게 영향을 주면 안됨

                - L : 리스코프 치환 원칙
                    - 이상적으로 테스트는 모든 케이스에 대해 커버하고 있으므로, 서브 클래스에 대한 치환 여부를 테스트가 알아서 판단 해줌

                - I : 인터페이스 분리 원칙
                    - 테스트는 그 자체로 인터페이스를 직접 사용해볼 수 있는  환경
                    - 불필요한 의존성을 실제로 확인할 수 있다

                - D : 의존성 역전 원칙
                    - 가짜 객체를 이용하여 테스트를 작성하려면, 의존성 역전이 되어야 하는 경우가 생김

            - 테스트가 SOLID를 강제하는 것은 아님
                - 테스트를 넣으면서 이런 것도 챙겨줘야 한다는 의미
                

    ⇒  단순히 회귀 버그 방지(품질 보증)만 바라보고 테스트를 구성하지 말고, 설계를 위한 도구로써도 같이 사용하면 테스트의 가치가 높아진다

